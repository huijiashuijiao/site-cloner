<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>采集任务列表</title>
    <link rel="stylesheet" href="/webjars/bootstrap/5.3.3/css/bootstrap.min.css" />
</head>
<body class="p-3">
<h3>采集任务列表</h3>
<div class="mb-2">
    <a href="/" class="btn btn-secondary btn-sm">返回</a>
    <button class="btn btn-outline-primary btn-sm" onclick="location.reload()">刷新</button>
</div>
<table class="table table-sm table-striped align-middle">
    <thead>
    <tr>
        <th>ID</th>
        <th>状态</th>
        <th>起始URL</th>
        <th>线程</th>
        <th>已下页数</th>
        <th>资产数</th>
        <th>错误数</th>
        <th>开始时间</th>
        <th>耗时</th>
        <th>操作</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="t : ${tasks}">
        <td th:text="${t.id}"></td>
        <td th:text="${t.status}"></td>
        <td th:text="${t.request.startUrl}"></td>
        <td th:text="${t.threadName}"></td>
        <td th:text="${t.pagesDownloaded}"></td>
        <td th:text="${t.assetsDownloaded}"></td>
        <td th:text="${t.errorsCount}"></td>
        <td th:text="${t.startTime}"></td>
        <td th:text="${t.duration}"></td>
        <td>
            <button class="btn btn-sm btn-outline-danger" th:attr="data-id=${t.id}" onclick="cancelTask(this)">取消</button>
        </td>
    </tr>
    </tbody>
</table>
<script>
function cancelTask(btn){
  var id = btn.getAttribute('data-id');
  if(!id) return;
  if(!confirm('确认取消任务: '+id+' ?')) return;
  fetch('/crawl/tasks/'+id+'/cancel', {method:'POST'})
    .then(function(r){return r.text();})
    .then(function(tx){ alert('取消结果: '+tx); location.reload(); })
    .catch(function(err){ alert('取消失败: '+err); });
}
</script>
</body>
</html>
